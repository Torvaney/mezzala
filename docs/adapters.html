---

title: Data Adapters


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/adapters.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/adapters.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">typing</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Basic-adapters">Basic adapters<a class="anchor-link" href="#Basic-adapters"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="KeyAdapter" class="doc_header"><code>class</code> <code>KeyAdapter</code><a href="https://github.com/Torvaney/mezzala/tree/master/mezzala/adapters.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>KeyAdapter</code>(<strong><code>home_goals</code></strong>, <strong><code>away_goals</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Get data from subscriptable objects.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Anything subscriptable can be with this type of adapter. For example,
you might have input data as a list of tuples (e.g. using Python's
in-built <code>csv</code> library)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index_adapter</span> <span class="o">=</span> <span class="n">KeyAdapter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">index_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">index_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Or, you might be using a list of dicts.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_adapter</span> <span class="o">=</span> <span class="n">KeyAdapter</span><span class="p">(</span><span class="s1">&#39;hg&#39;</span><span class="p">,</span> <span class="s1">&#39;ag&#39;</span><span class="p">,</span> <span class="n">home_team</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">away_team</span><span class="o">=</span><span class="s1">&#39;away&#39;</span><span class="p">)</span>

<span class="n">example_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;home&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;away&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hg&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;ag&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">dict_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">(</span><span class="n">example_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="k">assert</span> <span class="n">dict_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">(</span><span class="n">example_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">dict_adapter</span><span class="o">.</span><span class="n">home_team</span><span class="p">(</span><span class="n">example_dict</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Team 1&#39;</span>
<span class="k">assert</span> <span class="n">dict_adapter</span><span class="o">.</span><span class="n">away_team</span><span class="p">(</span><span class="n">example_dict</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Team 2&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nested data can be supplied using a list</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nested_dict_adapter</span> <span class="o">=</span> <span class="n">KeyAdapter</span><span class="p">(</span>
    <span class="n">home_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scoreline&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
    <span class="n">away_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scoreline&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">example_nested_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scoreline&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">nested_dict_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">(</span><span class="n">example_nested_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">nested_dict_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">(</span><span class="n">example_nested_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/mezzala/adapters.html#KeyAdapter"><code>KeyAdapter</code></a> could be used alongside <code>pd.DataFrame.iterrows</code> as well; however, it is much faster when using <code>pd.DataFrame.itertuples</code>.</p>
<p>Likewise, you can't use a <a href="/mezzala/adapters.html#KeyAdapter"><code>KeyAdapter</code></a> with custom objects (e.g. dataclasses).</p>
<p>In this case, you need an <a href="/mezzala/adapters.html#AttributeAdapter"><code>AttributeAdapter</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AttributeAdapter" class="doc_header"><code>class</code> <code>AttributeAdapter</code><a href="https://github.com/Torvaney/mezzala/tree/master/mezzala/adapters.py#L43" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AttributeAdapter</code>(<strong><code>home_goals</code></strong>, <strong><code>away_goals</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Get data from object attributes.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ExampleData</span><span class="p">:</span>
    <span class="n">hg</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ag</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">home</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">away</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">attr_adapter</span> <span class="o">=</span> <span class="n">AttributeAdapter</span><span class="p">(</span><span class="s1">&#39;hg&#39;</span><span class="p">,</span> <span class="s1">&#39;ag&#39;</span><span class="p">,</span> <span class="n">home_team</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">away_team</span><span class="o">=</span><span class="s1">&#39;away&#39;</span><span class="p">)</span>


<span class="n">example_attr</span> <span class="o">=</span> <span class="n">ExampleData</span><span class="p">(</span>
    <span class="n">home</span><span class="o">=</span><span class="s1">&#39;Another home team&#39;</span><span class="p">,</span>
    <span class="n">away</span><span class="o">=</span><span class="s1">&#39;Another away team&#39;</span><span class="p">,</span>
    <span class="n">hg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">attr_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">(</span><span class="n">example_attr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="k">assert</span> <span class="n">attr_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">(</span><span class="n">example_attr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">attr_adapter</span><span class="o">.</span><span class="n">home_team</span><span class="p">(</span><span class="n">example_attr</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Another home team&#39;</span>
<span class="k">assert</span> <span class="n">attr_adapter</span><span class="o">.</span><span class="n">away_team</span><span class="p">(</span><span class="n">example_attr</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Another away team&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As with <a href="/mezzala/adapters.html#KeyAdapter"><code>KeyAdapter</code></a>, nested attributes can also be fetched using lists</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Scoreline</span><span class="p">:</span>
    <span class="n">home</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">away</span><span class="p">:</span> <span class="nb">int</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ExampleNestedData</span><span class="p">:</span>
    <span class="n">scoreline</span><span class="p">:</span> <span class="n">Scoreline</span>
    <span class="n">home</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">away</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">nested_attr_adapter</span> <span class="o">=</span> <span class="n">AttributeAdapter</span><span class="p">(</span>
    <span class="n">home_team</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span>
    <span class="n">home_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scoreline&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">],</span> 
    <span class="n">away_team</span><span class="o">=</span><span class="s1">&#39;away&#39;</span><span class="p">,</span>
    <span class="n">away_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scoreline&#39;</span><span class="p">,</span> <span class="s1">&#39;away&#39;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">example_nested_attr</span> <span class="o">=</span> <span class="n">ExampleNestedData</span><span class="p">(</span>
    <span class="n">home</span><span class="o">=</span><span class="s1">&#39;Another home team&#39;</span><span class="p">,</span>
    <span class="n">away</span><span class="o">=</span><span class="s1">&#39;Another away team&#39;</span><span class="p">,</span>
    <span class="n">scoreline</span><span class="o">=</span><span class="n">Scoreline</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">nested_attr_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">(</span><span class="n">example_nested_attr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="n">nested_attr_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">(</span><span class="n">example_nested_attr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Composite-adapters">Composite adapters<a class="anchor-link" href="#Composite-adapters"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LumpedAdapter" class="doc_header"><code>class</code> <code>LumpedAdapter</code><a href="https://github.com/Torvaney/mezzala/tree/master/mezzala/adapters.py#L71" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LumpedAdapter</code>(<strong><code>base_adapter</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Lump terms which have appeared below a minimum number of times in
the training data into a placeholder term</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_lumped_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">*</span><span class="p">([</span><span class="n">example_dict</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span>  <span class="c1"># i.e., &#39;Team 1&#39; and &#39;Team 2&#39; appear in the data 4 times</span>
    <span class="p">{</span><span class="s1">&#39;away&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 1&#39;</span><span class="p">,</span>    <span class="c1"># &#39;Team 1&#39; now appears an additional time, (5 total)</span>
                          <span class="c1"># Although this time appears as an *away* team</span>
     <span class="s1">&#39;home&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 3&#39;</span><span class="p">,</span>    <span class="c1"># While &#39;Team 3&#39; appears once</span>
     <span class="s1">&#39;hg&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> 
     <span class="s1">&#39;ag&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">]</span>


<span class="n">lumped_dict_adapter</span> <span class="o">=</span> <span class="n">LumpedAdapter</span><span class="p">(</span>
    <span class="n">base_adapter</span><span class="o">=</span><span class="n">dict_adapter</span><span class="p">,</span>
    <span class="n">home_team</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Other team&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>      <span class="c1"># Because `home_team` and `away_team` share the same</span>
                                      <span class="c1"># placeholder value (&#39;Other team&#39;), they are counted</span>
                                      <span class="c1"># together. I.e. a team has to appear at least 5 times</span>
                                      <span class="c1"># as _either_ the home team, or the away team</span>
    <span class="n">away_team</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Other team&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">example_lumped_data</span><span class="p">)</span>

<span class="n">lumped_dict_adapter</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>LumpedAdapter(base_adapter=KeyAdapter(home_goals=&#39;hg&#39;, away_goals=&#39;ag&#39;, home_team=&#39;home&#39;, away_team=&#39;away&#39;), home_team=(&#39;Other team&#39;, 5), away_team=(&#39;Other team&#39;, 5))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_lumped_1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;home&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;away&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="s1">&#39;ag&#39;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="c1"># A team with more than the minimum number of observations appears as before</span>
<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">home_team</span><span class="p">(</span><span class="n">example_lumped_1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Team 1&#39;</span>

<span class="c1"># But a team with fewer observations appears as the placeholder</span>
<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">away_team</span><span class="p">(</span><span class="n">example_lumped_1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Other team&#39;</span>

<span class="c1"># Meanwhile, values without a placeholder in the LumpedAdapter</span>
<span class="c1"># also appear as before</span>
<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">home_goals</span><span class="p">(</span><span class="n">example_lumped_1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">away_goals</span><span class="p">(</span><span class="n">example_lumped_1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using a lumped adapter can also allow you to handle items which didn't appear in the training set at all:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_lumped_2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;home&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 2&#39;</span><span class="p">,</span>  <span class="c1"># Only appeared 4 times, below threshold of 5</span>
    <span class="s1">&#39;away&#39;</span><span class="p">:</span> <span class="s1">&#39;Team 4&#39;</span><span class="p">,</span>  <span class="c1"># Appeared 0 times in the data</span>
    <span class="s1">&#39;hg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="s1">&#39;ag&#39;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">home_team</span><span class="p">(</span><span class="n">example_lumped_2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Other team&#39;</span>
<span class="k">assert</span> <span class="n">lumped_dict_adapter</span><span class="o">.</span><span class="n">away_team</span><span class="p">(</span><span class="n">example_lumped_2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Other team&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

