---

title: Core


keywords: fastai
sidebar: home_sidebar

summary: "Team-strength models in Python"
description: "Team-strength models in Python"
nb_path: "nbs/core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pprint</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's demo</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/premier-league-1516.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pl_1516</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Let&#39;s parse the dates, too</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pl_1516</span><span class="p">:</span>
    <span class="n">match</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">pl_1516</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;date&#39;: datetime.datetime(2015, 8, 8, 0, 0),
  &#39;team1&#39;: &#39;Manchester United FC&#39;,
  &#39;team2&#39;: &#39;Tottenham Hotspur FC&#39;,
  &#39;score&#39;: {&#39;ft&#39;: [1, 0]}},
 {&#39;date&#39;: datetime.datetime(2015, 8, 8, 0, 0),
  &#39;team1&#39;: &#39;AFC Bournemouth&#39;,
  &#39;team2&#39;: &#39;Aston Villa FC&#39;,
  &#39;score&#39;: {&#39;ft&#39;: [0, 1]}},
 {&#39;date&#39;: datetime.datetime(2015, 8, 8, 0, 0),
  &#39;team1&#39;: &#39;Leicester City FC&#39;,
  &#39;team2&#39;: &#39;Sunderland AFC&#39;,
  &#39;score&#39;: {&#39;ft&#39;: [4, 2]}}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A model in <code>mezzala</code> is composed of 2 parts:</p>
<ul>
<li>Model blocks (see <code>mezzala.blocks</code>)</li>
<li>An adapter (see <code>mezzala.adapters</code>)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model blocks determine which terms your model estimates. In general, you will want
to estimate offensive and defensive strength for each team (<a href="/mezzala/blocks.html#TeamStrength"><code>TeamStrength</code></a>) and 
as well as home advantage <a href="/mezzala/blocks.html#HomeAdvantage"><code>HomeAdvantage</code></a>.</p>
<p>The selected model blocks can be supplied to the model as a list:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">TeamStrength</span><span class="p">(),</span> <span class="n">HomeAdvantage</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An adapter connects your model to the data source. In other words, it tells the model how find the information needed to fit.</p>
<p>The information needed is determined by which model blocks are used. In our case,</p>
<ul>
<li>All models require <code>home_goals</code> and <code>away_goals</code></li>
<li><a href="/mezzala/blocks.html#TeamStrength"><code>TeamStrength</code></a> - requires <code>home_team</code> and <code>away_team</code></li>
</ul>
<p><a href="/mezzala/blocks.html#HomeAdvantage"><code>HomeAdvantage</code></a> doesn't require any information, since it assumes all matches have equal home-field advantage by default.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">adapter</span> <span class="o">=</span> <span class="n">KeyAdapter</span><span class="p">(</span>               <span class="c1"># `KeyAdapter` = data[&#39;...&#39;]</span>
    <span class="n">home_team</span><span class="o">=</span><span class="s1">&#39;team1&#39;</span><span class="p">,</span>
    <span class="n">away_team</span><span class="o">=</span><span class="s1">&#39;team2&#39;</span><span class="p">,</span>
    <span class="n">home_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># Get nested fields with lists of fields</span>
    <span class="n">away_goals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># i.e. data[&#39;score&#39;][&#39;ft&#39;][1]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pulling this together, we can construct a model from an adapter and blocks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DixonColes</span><span class="p">(</span><span class="n">adapter</span><span class="o">=</span><span class="n">adapter</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pl_1516</span><span class="p">)</span>

<span class="c1"># All estimates should be valid numbers</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># Home advantage should be positive</span>
<span class="k">assert</span> <span class="mf">1.0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">HFA_KEY</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's inspect the parameters a bit. First, let's look at the boring (non-team) ones:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">param_keys</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">param_key_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_keys</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_keys</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TeamParameterKey</span><span class="p">):</span>
        <span class="n">key_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">param_key_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key_str</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ParameterKey(label=&#39;Home-field advantage&#39;)           : 1.23
ParameterKey(label=&#39;Rho&#39;)                            : 0.94
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the team ones. Let's look at each team's attacking quality:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">teams</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_keys</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TeamParameterKey</span><span class="p">)}</span>

<span class="n">team_offence</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">OffenceParameterKey</span><span class="p">(</span><span class="n">t</span><span class="p">)]))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">]</span>
<span class="k">for</span> <span class="n">team</span><span class="p">,</span> <span class="n">estimate</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">team_offence</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">team</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">estimate</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Manchester City FC: 1.38
Tottenham Hotspur FC: 1.33
Leicester City FC: 1.31
West Ham United FC: 1.27
Arsenal FC: 1.25
Liverpool FC: 1.23
Everton FC: 1.16
Chelsea FC: 1.15
Southampton FC: 1.14
Manchester United FC: 0.94
Sunderland AFC: 0.94
AFC Bournemouth: 0.89
Newcastle United FC: 0.87
Swansea City FC: 0.82
Stoke City FC: 0.81
Watford FC: 0.78
Norwich City FC: 0.77
Crystal Palace FC: 0.76
West Bromwich Albion FC: 0.66
Aston Villa FC: 0.54
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">team_defence</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">DefenceParameterKey</span><span class="p">(</span><span class="n">t</span><span class="p">)]))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">]</span>
<span class="k">for</span> <span class="n">team</span><span class="p">,</span> <span class="n">estimate</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">team_defence</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">team</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">estimate</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Manchester United FC: 0.82
Tottenham Hotspur FC: 0.84
Leicester City FC: 0.86
Arsenal FC: 0.86
Southampton FC: 0.97
Manchester City FC: 0.99
West Bromwich Albion FC: 1.10
Watford FC: 1.17
Liverpool FC: 1.19
Crystal Palace FC: 1.19
Swansea City FC: 1.21
West Ham United FC: 1.22
Chelsea FC: 1.26
Stoke City FC: 1.28
Everton FC: 1.32
Sunderland AFC: 1.46
Newcastle United FC: 1.52
Norwich City FC: 1.55
AFC Bournemouth: 1.57
Aston Villa FC: 1.75
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Making predictions for a single match</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scorelines</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">({</span>
    <span class="s1">&#39;team1&#39;</span><span class="p">:</span> <span class="s1">&#39;Manchester City FC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;team2&#39;</span><span class="p">:</span> <span class="s1">&#39;Swansea City FC&#39;</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># Probabilities should sum to 1</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
    <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">probability</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">scorelines</span><span class="p">),</span>
    <span class="mf">1.0</span>
<span class="p">)</span>

<span class="n">scorelines</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[ScorelinePrediction(home_goals=0, away_goals=0, probability=0.05607098119573087),
 ScorelinePrediction(home_goals=0, away_goals=1, probability=0.045632172429469826),
 ScorelinePrediction(home_goals=0, away_goals=2, probability=0.01856838525229347),
 ScorelinePrediction(home_goals=0, away_goals=3, probability=0.005037161466295112),
 ScorelinePrediction(home_goals=0, away_goals=4, probability=0.0010248466126474723)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outcomes</span> <span class="o">=</span> <span class="n">scorelines_to_outcomes</span><span class="p">(</span><span class="n">scorelines</span><span class="p">)</span>

<span class="c1"># MCFC should have a better chance of beating Swansea</span>
<span class="c1"># at home than Swansea do of winning away</span>
<span class="k">assert</span> <span class="n">outcomes</span><span class="p">[</span><span class="n">Outcomes</span><span class="p">(</span><span class="s1">&#39;Home win&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">probability</span> <span class="o">&gt;</span> <span class="n">outcomes</span><span class="p">[</span><span class="n">Outcomes</span><span class="p">(</span><span class="s1">&#39;Away win&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">probability</span>

<span class="nb">list</span><span class="p">(</span><span class="n">outcomes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Or for multiple matches</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">many_scorelines</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;team1&#39;</span><span class="p">:</span> <span class="s1">&#39;Manchester City FC&#39;</span><span class="p">,</span>
     <span class="s1">&#39;team2&#39;</span><span class="p">:</span> <span class="s1">&#39;Swansea City FC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;team1&#39;</span><span class="p">:</span> <span class="s1">&#39;Manchester City FC&#39;</span><span class="p">,</span>
     <span class="s1">&#39;team2&#39;</span><span class="p">:</span> <span class="s1">&#39;West Ham United FC&#39;</span><span class="p">}</span>
<span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What about a model with a different weighting method?</p>
<p>By default, the <a href="/mezzala/models.html#DixonColes"><code>DixonColes</code></a> model weights all matches equally. However, it's more realistic to give matches
closer to the current date a bigger weight than those a long time ago.</p>
<p>The original Dixon-Coles paper suggests using an exponential weight, and we can use the same:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">season_end_date</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pl_1516</span><span class="p">)</span>

<span class="n">weight</span> <span class="o">=</span> <span class="n">ExponentialWeight</span><span class="p">(</span>
    <span class="c1"># Value of `epsilon` is taken from the original paper</span>
    <span class="n">epsilon</span><span class="o">=-</span><span class="mf">0.0065</span><span class="p">,</span>  
    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">season_end_date</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_exp</span> <span class="o">=</span> <span class="n">DixonColes</span><span class="p">(</span>
    <span class="n">adapter</span><span class="o">=</span><span class="n">adapter</span><span class="p">,</span>
    <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span>
    <span class="n">weight</span><span class="o">=</span><span class="n">weight</span>
<span class="p">)</span>
<span class="n">model_exp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pl_1516</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How much does that change the ratings at season-end?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_keys</span><span class="p">:</span>
    <span class="n">key_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">param_key_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">model_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">model_exp_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_exp</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key_str</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">model_param</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">model_exp_param</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">model_exp_param</span><span class="o">/</span><span class="n">model_param</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

